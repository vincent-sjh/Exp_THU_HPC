# Report

本实验测量 OpenMP 并行 for 循环不同调度策略的性能。

### 代码添加

```c++
#pragma omp parallel for schedule(static)
```

```cpp
#pragma omp parallel for schedule(dynamic)
```

```CPP
#pragma omp parallel for schedule(guided)
```

### 3种调度策略对于2种测例的实验结果

| 平均时间\测例 | TEST1     | TEST2     |
| :-----------: | --------- | --------- |
|    无优化     | 1852.46ms | 3796.98ms |
|    static     | 68.30ms   | 190.42ms  |
|    dynamic    | 77.93ms   | 168.12ms  |
|    guided     | 69.65ms   | 163.77ms  |

### 结果分析

- `Static` 调度

- **TEST1: 68.30ms, TEST2: 190.42ms**
- **原因**：
  - Static 将 nParts 个分段平均分配给线程，任务划分固定。
  - **TEST1**：分段均匀，每个线程的工作量几乎相等，负载均衡极佳，排序时间短，性能最佳（加速比 ≈ 1852.46 / 68.30 ≈ 27）。
  - **TEST2**：分段长度随机，某些线程可能分配到长段（排序耗时长），其他线程分配到短段（早结束空闲），负载不均导致性能下降。
- **总结**：Static 适合均匀任务，但在不均匀任务中易受负载失衡影响。
- `Dynamic` 调度

- **TEST1: 77.93ms, TEST2: 168.12ms**
- **原因**：
  - Dynamic 动态分配任务，线程完成当前分段后取下一个，默认块大小为1。
  - **TEST1**：均匀分段下，动态调度无明显优势，且每次取任务有额外开销（同步和分配），比 static 略慢。
  - **TEST2**：随机分段时，动态性弥补负载不均，线程可快速处理短段后取新任务，避免空闲，性能优于 static。
- **总结**：Dynamic 适应性强，适合不均匀任务，但调度开销略高。
- `Guided` 调度

- **TEST1: 69.65ms, TEST2: 163.77ms**
- **原因**：
  - Guided 是自适应调度，初始分配大块任务，逐步减小到最小块（默认1），结合 static 和 dynamic 优点。
  - **TEST1**：均匀分段下，早期大块分配类似 static，后期调整影响小，性能接近 static 但略逊（因开销）。
  - **TEST2**：随机分段时，自适应性发挥作用，早期大块减少调度次数，后期小块平衡负载，性能最佳。
- **总结**：Guided 在不均匀任务中表现优异，综合性强。

结论

- **Static**：最佳于均匀任务（TEST1），负载均衡时效率最高。
- **Dynamic**：适应随机任务（TEST2），但调度开销稍高。
- **Guided**：综合表现最佳，尤其在不均匀任务（TEST2）中平衡了效率和灵活性。
- 选择调度策略需根据分段特性：均匀用 static，随机用 guided 或 dynamic。
