# MPI 异步通信小作业 实验报告 

宋建昊 2022010853

## 任务一

InfiniBand:


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        |    1.15    |    6.09    |
| 2    | 2        |     1.12   |    12.21    |
| 3    | 4        |   1.09     |   24.80     |
| 4    | 8        |   1.08     |    49.83    |
| 5    | 16       |   1.08     |    98.01    |
| 6    | 32       |   1.14     |    200.23    |
| 7    | 64       |   1.27     |    329.53    |
| 8    | 128      |   1.34     |    651.68    |
| 9    | 256      |   1.91     |     1031.06   |
| 10   | 512      |   1.99     |    1896.22    |
| 11   | 1024     |   2.24     |      2864.32  |
| 12   | 2048     |   2.73     |    4269.17    |
| 13   | 4096     |   3.66     |    8254.92    |
| 14   | 8192     |   5.23     |    9887.91    |
| 15   | 16384    |   7.18     |     10443.84   |
| 16   | 32768    |   9.91     |     11324.45   |
| 17   | 65536    |   15.48     |     11673.17   |
| 18   | 131072   |   27.14     |     11856.75   |
| 19   | 262144   |   32.19     |      11956.61  |
| 20   | 524288   |   56.89     |      12017.94   |
| 21   | 1048576  |   99.99     |      12043.45   |
| 22   | 2097152  |     187.58    |     12058.10   |
| 23   | 4194304  |   360.88     |      12059.12   |

以太网：

| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        |   42.49     |  0.31      |
| 2    | 2        |   42.66     |  0.62      |
| 3    | 4        |    42.58    |  1.23      |
| 4    | 8        |   42.74     |   2.39      |
| 5    | 16       |    42.83    |   4.97     |
| 6    | 32       |    43.12    |  9.06      |
| 7    | 64       |    44.08    |   16.08      |
| 8    | 128      |    45.66     |   33.90     |
| 9    | 256      |    50.25    |    54.47    |
| 10   | 512      |    55.90    |    80.02    |
| 11   | 1024     |   67.45     |   95.41     |
| 12   | 2048     |    84.53    |    104.90     |
| 13   | 4096     |    105.98    |   110.63     |
| 14   | 8192     |     163.08    |  114.13      |
| 15   | 16384    |   211.44     |   116.01     |
| 16   | 32768    |   356.13     |   116.83     |
| 17   | 65536    |    631.54    |   117.11     |
| 18   | 131072   |    1193.18    |   117.39     |
| 19   | 262144   |     2403.74    |    117.51     |
| 20   | 524288   |    4634.90    |      117.57   |
| 21   | 1048576  |     9077.44   |    117.61     |



- 请描述当消息长度增加时，带宽和延迟分别呈现出什么样的趋势？

    - 在消息长度较短时，延迟与消息长度基本无关，带宽与消息长度成正比
    - 在消息达到一定长度后，延迟与消息长度成正比，带宽基本保持不变

- 该趋势在两种网络下有何不同？

    - InfiniBand的最小延迟显著小于以太网，最大带宽显著高于以太网
    - 以太网的延迟增加速度比InfiniBand快得多，InfiniBand网络在带宽增加方面表现得更为明显

- 为什么会有这样的趋势？

    - 在消息长度较短时，延迟起主要影响的是传输的固定开销，因此延迟随消息长度增长不明显。带宽没有达到传输方式的带宽上界，因此与消息长度成正比。
    - 在消息长度很长时，消息长度成为影响延迟的主要因素，延迟与消息长度成正比。带宽逐渐达到了带宽上限，不在随消息长度变化。

- 对比InfiniBand和以太网络下的带宽和延迟，它们之间的差距是多少？

    - InfiniBand和以太网在带宽上的差距显著,InfiniBand的最大带宽为12059.12 MB/s，而以太网仅为117.61 MB/s，相同消息长度InfiniBand带宽是以太网的16倍左右。
    - 以太网在相同消息长度下的延迟是InfiniBand的35倍左右。

## 任务二

| 编号 | 消息长度  | 计算量 | mpi_sync 总耗时 | mpi_async  总耗时 |
| ---- | --------- | ------ | --------------- | ----------------- |
| 1    | 100000000 | 10     |970.722             |837.736             |
| 2    | 100000000 | 20     | 1071.52            |  839.428              |
| 3    | 100000000 | 40     | 1273.08            | 837.79              |
| 4    | 100000000 | 80     | 1679.79           | 837.055            |
| 5    | 100000000 | 160    | 2480.76            |1600.53             |

- 通信时间和计算时间满足什么关系时，非阻塞通信程序能完美掩盖通信时间？

在MPI程序中，非阻塞通信能够完美掩盖通信时间的关键在于通信时间和计算时间的重叠。理想情况下，如果计算时间足够长，以至于大于或等于通信时间，那么非阻塞通信就能够完美掩盖通信时间。

- 简述两份代码的不同之处。

每轮迭代中，`mpi_async.cpp`中，0号进程通过异步的`MPI_Isend`来发送数据，迭代完毕后通过`MPI_Wait`来确保发送完毕。而`mpi_sync.cpp`中，0号进程通过同步的`MPI_Send`发送数据。

